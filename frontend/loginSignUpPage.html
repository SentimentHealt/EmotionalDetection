<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Journal App</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@300;400;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
    <style type="text/tailwindcss">
        :root {
            --primary-color: #f4b4c4;
            --background-light: #fff8f9;
            --background-dark: #2a3141;
            --text-light: #52474a;
            --text-dark: #e8dee1;
            --accent-color: #f7d9a1;
            --complementary-color-1: #a9def9;
            --complementary-color-2: #e4c1f9;
            --pink-harmony-1: #ffc0cb;
            --pink-harmony-2: #e4c1f9;
            --pink-harmony-3: #a9def9;
            --pink-harmony-4: #f4b4c4;
        }
        body {
            font-family: 'Gaegu', cursive;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24
        }
        .scribble-button {
            border: 2px solid var(--text-light);
            border-radius: 15px 225px 255px 15px 15px 255px 225px 15px;
            transition: all 0.3s ease-in-out;
        }
        .dark .scribble-button {
            border-color: var(--text-dark);
        }
        .scribble-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        .scribble-input {
            border: 2px solid var(--text-light);
            border-radius: 255px 15px 225px 15px/15px 225px 15px 255px;
            transition: all 0.3s ease-in-out;
        }
        .scribble-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(244, 180, 196, 0.4);
            outline: none;
        }
        #login-form,
        #signup-form,
        #survey-form {
            display: none;
        }
        #initial-screen:target~#login-form,
        #initial-screen:target~#signup-form,
        #initial-screen:target~#survey-form {
            display: none;
        }
        #initial-screen:target {
            display: flex;
        }
         :target~#initial-screen {
            display: none;
        }
        #login-form:target {
            display: flex;
        }
        #signup-form:target {
            display: flex;
        }
        #survey-form:target {
            display: flex;
        }
        @keyframes wave {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        .animated-background {
            background: linear-gradient(45deg, var(--pink-harmony-4), var(--pink-harmony-2), var(--pink-harmony-3), var(--pink-harmony-1));
            background-size: 400% 400%;
            animation: wave 15s ease infinite;
        }
        .survey-question {
            transform: translateX(100vw);
            opacity: 0;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            position: absolute;
            width: 100%;
        }
        .survey-question.active {
            transform: translateX(0);
            opacity: 1;
            position: relative;
        }
        .survey-question.exiting {
            transform: translateX(-100vw);
            opacity: 0;
        }
    </style>
</head>
<body class="bg-[var(--background-light)] dark:bg-[var(--background-dark)] text-[var(--text-light)] dark:text-[var(--text-dark)] antialiased">
<div class="min-h-screen flex flex-col">
    <header class="absolute top-0 right-0 p-6 z-10">
        <div class="flex items-center gap-4">
            <a class="scribble-button bg-[var(--primary-color)]/80 hover:bg-[var(--primary-color)] text-[var(--text-light)] dark:text-[var(--text-dark)] hover:text-white font-bold py-2 px-5 text-lg" href="#login-form">Login</a>
            <a class="scribble-button bg-white/80 hover:bg-[var(--primary-color)] text-[var(--text-light)] dark:text-[var(--text-light)] hover:text-white font-bold py-2 px-5 text-lg" href="#signup-form">Sign Up</a>
        </div>
    </header>
    <main class="flex-grow flex items-center justify-center animated-background" id="initial-screen">
        <div class="text-center">
            <h1 class="text-7xl md:text-8xl font-bold text-white drop-shadow-lg" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">My Soul Notes</h1>
            <a class="hidden" href="#initial-screen"></a>
        </div>
    </main>
    <main class="flex-grow flex items-center justify-center" id="login-form">
        <div class="text-center w-full max-w-md px-4">
            <div class="relative inline-block mb-8">
                <div class="w-32 h-32 bg-[var(--primary-color)] rounded-full flex items-center justify-center text-white shadow-lg" style="border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;">
                    <span class="material-symbols-outlined text-6xl transform -rotate-12"> auto_awesome </span>
                </div>
                <div class="absolute -top-4 -left-8 text-5xl transform -rotate-12 animate-pulse">‚ú®</div>
                <div class="absolute -bottom-4 -right-8 text-3xl transform rotate-12 animate-pulse" style="animation-delay: 0.5s;">üíñ</div>
            </div>
            <h1 class="text-5xl md:text-6xl font-bold mb-4">Welcome Back</h1>
            <p class="text-xl text-[var(--text-light)]/80 dark:text-[var(--text-dark)]/80 mb-12">Let's continue your story.</p>
            <form class="space-y-6" id="loginForm">
                <div>
                    <input id="login-email" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0" placeholder="Your Email" type="email"/>
                </div>
                <div>
                    <input id="login-password" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0" placeholder="Your Password" type="password"/>
                </div>
                <div>
                    <button class="w-full scribble-button bg-[var(--primary-color)]/80 hover:bg-[var(--primary-color)] text-[var(--text-light)] hover:text-white font-bold py-4 px-6 text-xl transition-all" type="submit"> Login </button>
                </div>
            </form>
            <a class="inline-block mt-6 text-md text-[var(--text-light)]/60 dark:text-[var(--text-dark)]/60 hover:text-[var(--primary-color)] transition-colors" href="#">Forgot your password?</a>
        </div>
    </main>
    <main class="flex-grow flex items-center justify-center" id="signup-form">
        <div class="text-center w-full max-w-md px-4">
            <div class="relative inline-block mb-8">
                <div class="w-32 h-32 bg-[var(--primary-color)] rounded-full flex items-center justify-center text-white shadow-lg" style="border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;">
                    <span class="material-symbols-outlined text-6xl transform rotate-12"> diversity_3 </span>
                </div>
                <div class="absolute -top-4 -left-8 text-5xl transform -rotate-12 animate-pulse">üìù</div>
                <div class="absolute -bottom-4 -right-8 text-3xl transform rotate-12 animate-pulse" style="animation-delay: 0.5s;">üíï</div>
            </div>
            <h1 class="text-5xl md:text-6xl font-bold mb-4">Create Your Account</h1>
            <p class="text-xl text-[var(--text-light)]/80 dark:text-[var(--text-dark)]/80 mb-12">Join our community and start your journey.</p>
            <form class="space-y-6" id="signupForm">
                <div>
                    <input class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0" placeholder="Your Name" type="text" id="signup-name"/>
                </div>
                <div>
                    <input class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0" placeholder="Your Email" type="email" id="signup-email"/>
                </div>
                <div>
                    <input class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0" placeholder="Create a Password" type="password" id="signup-password"/>
                </div>
                <div>
                    <a class="w-full block scribble-button bg-[var(--primary-color)]/80 hover:bg-[var(--primary-color)] text-[var(--text-light)] hover:text-white font-bold py-4 px-6 text-xl transition-all" href="#survey-form" onclick="storeUserData()"> Sign Up &amp; Personalize </a>
                </div>
            </form>
            <a class="inline-block mt-6 text-md text-[var(--text-light)]/60 dark:text-[var(--text-dark)]/60 hover:text-[var(--primary-color)] transition-colors" href="#login-form">Already have an account? Login</a>
        </div>
    </main>
    <main class="flex-grow flex flex-col items-center justify-center overflow-hidden" id="survey-form">
        <div class="text-center w-full max-w-2xl px-4 relative">
            <div class="relative inline-block mb-8">
                <div class="w-32 h-32 bg-[var(--primary-color)] rounded-full flex items-center justify-center text-white shadow-lg" style="border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;">
                    <span class="material-symbols-outlined text-6xl transform -rotate-12"> quiz </span>
                </div>
                <div class="absolute -top-2 -left-8 text-4xl transform -rotate-12 animate-pulse">ü§î</div>
                <div class="absolute -bottom-2 -right-8 text-4xl transform rotate-12 animate-pulse" style="animation-delay: 0.5s;">üí°</div>
            </div>
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Tell Us a Bit About Yourself.</h1>
            <p class="text-lg text-[var(--text-light)]/80 dark:text-[var(--text-dark)]/80 mb-10">This will help us personalize your experience.</p>
            <div class="relative min-h-[250px]" id="survey-container">
                <div class="survey-question active" data-question="1">
                    <h2 class="text-3xl font-semibold mb-6">How do you usually spend your weekends?</h2>
                    <textarea name="q1" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
                <div class="survey-question" data-question="2">
                    <h2 class="text-3xl font-semibold mb-6">What do you enjoy doing in your free time?</h2>
                    <textarea name="q2" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
                <div class="survey-question" data-question="3">
                    <h2 class="text-3xl font-semibold mb-6">Are you open to learning new things?</h2>
                    <textarea name="q3" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
                <div class="survey-question" data-question="4">
                    <h2 class="text-3xl font-semibold mb-6">What do you usually do when spending time with your friends?</h2>
                    <textarea name="q4" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
                <div class="survey-question" data-question="5">
                    <h2 class="text-3xl font-semibold mb-6">Do you do sports? If yes, what kinds?</h2>
                    <textarea name="q5" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
                <div class="survey-question" data-question="6">
                    <h2 class="text-3xl font-semibold mb-6">Are you interested in art or music?</h2>
                    <textarea name="q6" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
                <div class="survey-question" data-question="7">
                    <h2 class="text-3xl font-semibold mb-6">What do you do when you spend time alone?</h2>
                    <textarea name="q7" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
                <div class="survey-question" data-question="8">
                    <h2 class="text-3xl font-semibold mb-6">Do you like traveling?</h2>
                    <textarea name="q8" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
                <div class="survey-question" data-question="9">
                    <h2 class="text-3xl font-semibold mb-6">Which activities motivate you?</h2>
                    <textarea name="q9" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
                <div class="survey-question" data-question="10">
                    <h2 class="text-3xl font-semibold mb-6">Can you tell us about your hobbies?</h2>
                    <textarea name="q10" class="w-full scribble-input bg-transparent py-3 px-5 text-lg placeholder-[var(--text-light)]/40 dark:placeholder-[var(--text-dark)]/40 focus:ring-0 h-32" placeholder="Cevabƒ±nƒ± buraya yaz..."></textarea>
                </div>
            </div>
            <div class="flex justify-center items-center mt-8 space-x-4">
                <button class="scribble-button bg-white/80 hover:bg-[var(--complementary-color-1)] text-[var(--text-light)] font-bold py-3 px-6 text-lg transition-all" onclick="navigateSurvey(-1)">Geri</button>
                <div class="flex space-x-2">
                </div>
                <button class="scribble-button bg-[var(--primary-color)]/80 hover:bg-[var(--primary-color)] text-[var(--text-light)] hover:text-white font-bold py-3 px-6 text-lg transition-all" onclick="navigateSurvey(1)">ƒ∞leri</button>
            </div>
            <button class="hidden w-1/2 mt-4 mx-auto scribble-button bg-[var(--accent-color)]/80 hover:bg-[var(--accent-color)] text-[var(--text-light)] hover:text-white font-bold py-4 px-6 text-xl transition-all" id="finish-button" onclick="finishSurvey()">Bitir</button>
        </div>
    </main>
    <footer class="p-6 text-center text-sm text-[var(--text-light)]/50 dark:text-[var(--text-dark)]/50">
        <p>My Soul Notes. Created by Iclal and Sevval.</p>
    </footer>
</div>
<script>
  // --- Survey state ---
  let currentQuestion = 1;
  const totalQuestions = 10;
  const surveyContainer = document.getElementById('survey-container');
  const finishButton = document.getElementById('finish-button');
  const nextButton = document.querySelector('button[onclick="navigateSurvey(1)"]');
  const prevButton = document.querySelector('button[onclick="navigateSurvey(-1)"]');

  function navigateSurvey(direction) {
    const current = document.querySelector(`.survey-question[data-question="${currentQuestion}"]`);
    let nextQuestionIndex = currentQuestion + direction;
    if (nextQuestionIndex < 1 || nextQuestionIndex > totalQuestions) return;

    const next = document.querySelector(`.survey-question[data-question="${nextQuestionIndex}"]`);
    current.style.transform = `translateX(${direction * -100}vw)`;
    next.style.transform = 'translateX(0)';

    current.classList.remove('active');
    next.classList.add('active');

    currentQuestion = nextQuestionIndex;
    updateButtons();
  }

  function updateButtons() {
    if (currentQuestion === totalQuestions) {
      finishButton.classList.remove('hidden');
      nextButton.classList.add('hidden');
    } else {
      finishButton.classList.add('hidden');
      nextButton.classList.remove('hidden');
    }
    prevButton.style.visibility = currentQuestion === 1 ? 'hidden' : 'visible';
  }
  updateButtons();

  // --- Sign up: ge√ßici kullanƒ±cƒ± verisi + anket yanƒ±tlarƒ± ---
  let userData = {};
  function storeUserData() {
    userData.name = document.getElementById('signup-name').value;
    userData.email = document.getElementById('signup-email').value;
    userData.password = document.getElementById('signup-password').value;
  }

  async function finishSurvey() {
    const answers = {};
    const textareas = document.querySelectorAll('#survey-container textarea');
    textareas.forEach(t => { answers[t.name] = t.value || ""; });

    const finalData = { ...userData, answers };
    try {
      const res = await fetch('/api/signup', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(finalData)
      });
      const data = await res.json().catch(() => ({}));

      if (res.ok && data.success) {
        // (Opsiyonel) Otomatik login:
        const loginRes = await fetch('/api/login', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ email: userData.email, password: userData.password })
        });
        const loginData = await loginRes.json().catch(() => ({}));

        if (loginRes.ok) {
          sessionStorage.setItem('user', JSON.stringify(loginData.user));
          if (loginData.access_token) sessionStorage.setItem('token', loginData.access_token);
          window.location.replace('/journal');
        } else {
          alert('Account created. Please login.');
          window.location.hash = '#login-form';
        }
      } else {
        alert(data.error || 'Sign up failed');
      }
    } catch (err) {
      console.error(err);
      alert('Network error');
    }
  }

  // --- LOGIN: sadece bu handler deƒüi≈üti ---
  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("login-email").value.trim();
    const password = document.getElementById("login-password").value;

    try {
      const res = await fetch("/api/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ email, password })
      });
      const data = await res.json().catch(() => ({}));

      if (!res.ok) {
        alert(data.error || "Login failed");
        return;
      }

      // Journal sayfasƒ± bunu bekliyor:
      sessionStorage.setItem("user", JSON.stringify(data.user));
      if (data.access_token) sessionStorage.setItem("token", data.access_token);

      window.location.replace("/journal");
    } catch (err) {
      console.error(err);
      alert("Network error");
    }
  });
</script>
</body>
</html>